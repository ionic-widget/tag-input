angular.module("ui.taginput",[]).provider("TagInputConfig",function(){function t(t,e,n){if(r[t]){var i=r[t](e);return void 0==i?n:i}return null}var e=function(){},n={displayProperty:{type:String,"default":"value"},keyProperty:{type:String,"default":"value"},type:{type:e,"default":"text"},minLength:{type:Number,"default":0},maxLength:{type:Number,"default":Number.MAX_SAFE_INTEGER},minTags:{type:Number,"default":0},maxTags:{type:Number,"default":Number.MAX_SAFE_INTEGER},allowMoreThanMaxTags:{type:Boolean,"default":!0},placeholder:{type:String,"default":""},icon:{type:String,"default":""},addOnEnter:{type:Boolean,"default":!0},addOnSpace:{type:Boolean,"default":!1},addOnComma:{type:Boolean,"default":!0},addOnBlur:{type:Boolean,"default":!0},allowedTagsPattern:{type:String,"default":".+"},enableEditingLastTag:{type:Boolean,"default":!1}},i=["text","email","url"],a=Model({init:function(e){for(var i in n)this[i]=t(n[i].type,e[i],n[i]["default"]);this.allowedTagsPatternRegex=new RegExp(this.allowedTagsPattern)},extend:function(e){for(var i in n)this[i]=t(n[i].type,e[i],this[i]);this.allowedTagsPatternRegex=new RegExp(this.allowedTagsPattern)},set:function(e,i){e in this&&(this[e]=t(n[e].type,i,this[e]),"allowedTagsPattern"===e&&(this.allowedTagsPatternRegex=new RegExp(this.allowedTagsPattern)))}}),r={};r[String]=function(t){return angular.isString(t)?t:void 0},r[Number]=function(t){return/^\d+$/.test(t)?parseInt(t):void 0},r[Array]=function(t){return angular.isArray(t)?t:void 0},r[Boolean]=function(t){if(t===!0||t===!1)return t;if(angular.isString(t)){if("true"===t)return!0;if("false"===t)return!1}},r[e]=function(t){for(var e=0;e<i.length;e++)if(i[e]===t)return i[e]};var u=Model({_tags:[],_text:{value:""},init:function(t){this._config=new a(t)},pushTag:function(t){if(angular.isDefined(t)){if(angular.isString(t)){if(""!==t&&this.config("allowedTagsPatternRegex").test(t)&&t.length>=this.config("minLength")&&t.length<=this.config("maxLength")){var e={};return e[this.config("displayProperty")]=t,e[this.config("keyProperty")]=t,!!this.pushTag(e)}return!1}if(angular.isArray(t)){for(var n=0;n<t.length;n++)if(!this.pushTag(t[n]))return!1}else{if(!angular.isObject(t))return!1;if(!this.config("allowMoreThanMaxTags")&&this._tags.length>=this._config.maxTags)return!1;if(null!==this.getTagByKey(t[this.config("keyProperty")]))return!1;this._tags.push(t),setTimeout(function(){this.trigger("onTagAdded",t)}.bind(this))}}else if(""!==this.text())return this.pushTag(this.text())&&!!this.text("");return!0},popTag:function(t){if(angular.isDefined(t)){if(angular.isNumber(t)){if(t>=0){var e=this._tags.splice(t,1);if(1===e.length)return setTimeout(function(){this.trigger("onTagRemoved",e[0])}.bind(this)),e[0]}}else if(angular.isObject(t)){var n=this._tags.indexOf(t);return this.popTag(n)}}else{var e=this._tags.pop();if(void 0!==e)return setTimeout(function(){this.trigger("onTagRemoved",e)}.bind(this)),e}return null},config:function(t,e){if(angular.isDefined(e))this._config.set(t,e);else{if(angular.isString(t))return this._config[t];if(!angular.isObject(t))throw new Exception("Unsupported Operation");this._config.extend(config)}},text:function(t){return angular.isDefined(t)?void(this._text.value=t):this._text.value},getTags:function(){return this._tags},getTagByKey:function(t){for(var e=this.config("keyProperty"),n=0;n<this._tags.length;n++)if(this._tags[n][e]===t)return this._tags[n];return null}}),s={};this.$get=function(){return this},this.createTagInput=function(t,e){return s[t]?(console.error("ui-tag-input with identifier '"+t+"' exists before."),s[t].extendConfig(e)):s[t]=new u(e),s[t]},this.getTagInput=function(t){return s[t]?s[t]:this.createTagInput(t,{})}});
angular.module("ui.taginput").directive("tagInput",["$timeout","$interpolate","TagInputConfig",function(n,t,e){function i(i,a,o,g){function u(){i.tags=s.getTags(),l(),g.$setDirty(),c(),s.config("allowMoreThanMaxTags")||r()}function c(){g.$setValidity("maxTags",s.getTags().length<=s.config("maxTags")),g.$setValidity("minTags",s.getTags().length>=s.config("minTags")),g.$validate()}function l(){n(function(){a[0].scrollLeft=a[0].scrollWidth})}function r(){s.getTags().length==s.config("maxTags")?a.addClass("ui-tag-full"):a.removeClass("ui-tag-full")}var s=e.getTagInput(i.uiTagInputId),d=a.find("input")[0];if(""!==s.config("icon")){var p=t('<span class="icon ion {{icon}} "></span>')({icon:s.config("icon")});a.prepend(angular.element(p)),a.addClass("withIcon")}a.bind("click",function(t){t.target==a[0]&&n(function(){d.focus()})}),g.$isEmpty=function(n){return!n||!n.length},s.on("onTagAdded",u).on("onTagRemoved",u),i.tags&&i.tags.length>0&&(g.$setDirty(),i.tags.forEach(function(n){s.pushTag(n)})),c()}return{restrict:"E",replace:!0,require:"ngModel",scope:{uiTagInputId:"@",tags:"=ngModel"},template:'<div class="item ui-tag-input"><tag-list ui-tag-input-id="{{::uiTagInputId}}"></tag-list><growing-input ui-tag-input-id="{{::uiTagInputId}}"></growing-input></div>',compile:function(n,t){return e.createTagInput(t.uiTagInputId,t),i}}}]).directive("tagList",["TagInputConfig","$interpolate",function(n,t){return{restrict:"E",template:'<div class="tag-container"></div>',link:{pre:function(e,i,a){function o(n){c.popTag(this)}function g(n){return n[c.config("displayProperty")]}var u=a.uiTagInputId,c=n.getTagInput(u),l=i.find(".tag-container"),r={};c.on("onTagAdded",function(n){var e=t('<pill class="ui-tag-input-pill">{{name}} <i class="ion-close-round"></i></pill>')({name:g(n)}),i=angular.element(e);r[JSON.stringify(n)]=i,l.append(i),i.on("click",o.bind(n))}),c.on("onTagRemoved",function(n){var t=r[JSON.stringify(n)];t.off("click"),t.remove(),delete t})}}}}]).directive("growingInput",["TagInputConfig","$timeout",function(n,t){return{restrict:"E",template:'<div class="growingInput"><input type="text" placeholder="{{::placeholder}}" type="{{::inputType}}" ng-model="text.value"><span class="hiddenText">{{text.value || placeholder}}</span></div>',link:function(e,i,a){function o(){var n=g(r[0]),e=d.text(),i=e.substring(0,n);t(function(){d.pushTag(i)?(d.text(e.substring(n)),t(function(){u(r[0],0)})):r.addClass("error")})}function g(n){return n.selectionStart===n.selectionEnd?n.selectionStart:-1}function u(n,t){n.setSelectionRange(t,t)}function c(){d.getTags().length==d.config("maxTags")?(r.blur(),r.attr("disabled","disabled"),r.addClass("ui-tag-hide")):(r.removeAttr("disabled"),r.removeClass("ui-tag-hide"))}var l=a.uiTagInputId,r=i.find("input"),s=i.find("span"),d=n.getTagInput(l);e.placeholder=d.config("placeholder"),e.inputType=d.config("type"),e.text=d._text,e.$watch("text.value",function(){var n=s.width()+20;r.css("width",n+"px"),r.removeClass("error")}),r.on("blur",function(){t(d.pushTag)}),angular.element(r).bind("keydown keypress",function(n){switch(n.which){case 8:case 46:0===g(r[0])&&(t(function(){var n=d.popTag();if(null!==n&&d.config("enableEditingLastTag")){var e=n[d.config("displayProperty")];d.text(e+d.text()),t(function(){u(r[0],e.length)})}}),n.preventDefault());break;case 13:d.config("addOnEnter")&&(o(),n.preventDefault());break;case 32:d.config("addOnSpace")&&(o(),n.preventDefault());break;case 188:d.config("addOnComma")&&(o(),n.preventDefault())}}),d.config("allowMoreThanMaxTags")||d.on("onTagAdded",c).on("onTagRemoved",c)}}}]);
Model=function n(o,t,i,f){function e(){var n=this,e={};n.on=function(n,o){(e[n]||(e[n]=[])).push(o)},n.trigger=function(n,o){for(var t=e[n],i=0;t&&i<t.length;)t[i++](o)},n.off=function(n,o){for(i=e[n]||[];o&&(t=i.indexOf(o))>-1;)i.splice(t,1);e[n]=o?i:[]};for(t in o)i=o[t],n[t]="function"==typeof i?function(){return(i=this.apply(n,arguments))===f?n:i}.bind(i):i;n.init&&n.init.apply(n,arguments)}return e.extend=function(e){i={};for(t in o)i[t]=o[t];for(t in e)i[t]=e[t],o[t]!==f&&(i["__"+t]=o[t]);return n(i)},e},"object"==typeof module&&(module.exports=Model);
