angular.module("ui.taginput",[]).provider("TagInputConfig",function(){function t(t,e,n){if(i[t]){var a=i[t](e);return void 0==a?n:a}return null}var e={displayProperty:{type:String,"default":"value"},keyProperty:{type:String,"default":"value"},minLength:{type:Number,"default":0},maxLength:{type:Number,"default":Number.MAX_SAFE_INTEGER},minTags:{type:Number,"default":0},maxTags:{type:Number,"default":Number.MAX_SAFE_INTEGER},allowMoreThanMaxTags:{type:Boolean,"default":!0},placeholder:{type:String,"default":""},icon:{type:String,"default":""},addOnEnter:{type:Boolean,"default":!0},addOnSpace:{type:Boolean,"default":!1},addOnComma:{type:Boolean,"default":!0},addOnBlur:{type:Boolean,"default":!0},allowedTagsPattern:{type:String,"default":".+"},enableEditingLastTag:{type:Boolean,"default":!1}},n=Model({init:function(n){for(var i in e)this[i]=t(e[i].type,n[i],e[i]["default"]);this.allowedTagsPatternRegex=new RegExp(this.allowedTagsPattern)},extend:function(n){for(var i in e)this[i]=t(e[i].type,n[i],this[i]);this.allowedTagsPatternRegex=new RegExp(this.allowedTagsPattern)},set:function(n,i){n in this&&(this[n]=t(e[n].type,i,this[n]),"allowedTagsPattern"===n&&(this.allowedTagsPatternRegex=new RegExp(this.allowedTagsPattern)))}}),i={};i[String]=function(t){return angular.isString(t)?t:void 0},i[Number]=function(t){return/^\d+$/.test(t)?parseInt(t):void 0},i[Array]=function(t){return angular.isArray(t)?t:void 0},i[Boolean]=function(t){if(t===!0||t===!1)return t;if(angular.isString(t)){if("true"===t)return!0;if("false"===t)return!1}};var a=Model({_tags:[],_text:{value:""},init:function(t){this._config=new n(t)},extendConfig:function(t){this._config.extend(t)},pushTag:function(t){if(angular.isDefined(t)){if(angular.isString(t)){if(""!==t&&this.config("allowedTagsPatternRegex").test(t)&&t.length>=this.config("minLength")&&t.length<=this.config("maxLength")){var e={};return e[this.config("displayProperty")]=t,!!this.pushTag(e)}return!1}if(angular.isArray(t)){for(var n=0;n<t.length;n++)if(!this.pushTag(t[n]))return!1}else{if(!angular.isObject(t))return!1;if(!this.config("allowMoreThanMaxTags")&&this._tags.length>=this._config.maxTags)return!1;if(null!==this.getTagByKey(t[this.config("keyProperty")]))return!1;this._tags.push(t),setTimeout(function(){this.trigger("onTagAdded",t)}.bind(this))}}else if(""!==this.text())return this.pushTag(this.text())&&!!this.text("");return!0},popTag:function(t){if(angular.isDefined(t)){if(angular.isNumber(t)){if(t>=0){var e=this._tags.splice(t,1);if(1===e.length)return setTimeout(function(){this.trigger("onTagRemoved",e[0])}.bind(this)),e[0]}}else if(angular.isObject(t)){var n=this._tags.indexOf(t);return this.popTag(n)}}else{var e=this._tags.pop();if(void 0!==e)return setTimeout(function(){this.trigger("onTagRemoved",e)}.bind(this)),e}return null},config:function(t,e){return angular.isDefined(e)?void this._config.set(t,e):this._config[t]},text:function(t){return angular.isDefined(t)?void(this._text.value=t):this._text.value},getTags:function(){return this._tags},getTagByKey:function(t){for(var e=this.config("keyProperty"),n=0;n<this._tags.length;n++)if(this._tags[n][e]===t)return this._tags[n];return null}}),r={};this.$get=function(){return this},this.createTagInput=function(t,e){return r[t]?(console.error("ui-tag-input with identifier '"+t+"' exists before."),r[t].extendConfig(e)):r[t]=new a(e),r[t]},this.getTagInput=function(t){return r[t]?r[t]:this.createTagInput(t,{})}});
angular.module("ui.taginput").directive("tagInput",["$timeout","$interpolate","TagInputConfig",function(n,t,e){function i(i,a,o,g){function u(){i.tags=l.getTags(),r(),g.$setDirty(),c()}function c(){g.$setValidity("maxTags",l.getTags().length<=l.config("maxTags")),g.$setValidity("minTags",l.getTags().length>=l.config("minTags")),g.$validate()}function r(){n(function(){a[0].scrollLeft=a[0].scrollWidth})}var l=e.getTagInput(i.uiTagInputId),s=a.find("input")[0];if(""!==l.config("icon")){var d=t('<span class="icon ion {{icon}} "></span>')({icon:l.config("icon")});a.prepend(angular.element(d)),a.addClass("withIcon")}a.bind("click",function(t){t.target==a[0]&&n(function(){s.focus()})}),g.$isEmpty=function(n){return!n||!n.length},l.on("onTagAdded",u).on("onTagRemoved",u),i.tags&&i.tags.length>0&&(g.$setDirty(),i.tags.forEach(function(n){l.pushTag(n)})),c()}return{restrict:"E",replace:!0,require:"ngModel",scope:{uiTagInputId:"@",tags:"=ngModel"},template:'<div class="item ui-tag-input"><tag-list ui-tag-input-id="{{::uiTagInputId}}"></tag-list><growing-input ui-tag-input-id="{{::uiTagInputId}}"></growing-input></div>',compile:function(n,t){return e.createTagInput(t.uiTagInputId,t),i}}}]).directive("tagList",["TagInputConfig","$interpolate",function(n,t){return{restrict:"E",template:'<div class="tag-container"></div>',link:{pre:function(e,i,a){function o(n){c.popTag(this)}function g(n){return n[c.config("displayProperty")]}var u=a.uiTagInputId,c=n.getTagInput(u),r=i.find(".tag-container"),l={};c.on("onTagAdded",function(n){var e=t('<pill class="ui-tag-input-pill">{{name}} <i class="ion-close-round"></i></pill>')({name:g(n)}),i=angular.element(e);l[JSON.stringify(n)]=i,r.append(i),i.on("click",o.bind(n))}),c.on("onTagRemoved",function(n){var t=l[JSON.stringify(n)];t.off("click"),t.remove(),delete t})}}}}]).directive("growingInput",["TagInputConfig","$timeout",function(n,t){return{restrict:"E",template:'<div class="growingInput"><input type="text" placeholder="{{placeholder}}" ng-model="text.value"><span class="hiddenText">{{text.value || placeholder}}</span></div>',link:function(e,i,a){function o(){var n=g(l[0]),e=d.text(),i=e.substring(0,n);t(function(){d.pushTag(i)?(d.text(e.substring(n)),t(function(){u(l[0],0)})):l.addClass("error")})}function g(n){return n.selectionStart===n.selectionEnd?n.selectionStart:-1}function u(n,t){n.setSelectionRange(t,t)}function c(){d.getTags().length==d.config("maxTags")?(l.blur(),l.attr("disabled","disabled"),l.addClass("hide")):(l.removeAttr("disabled"),l.removeClass("hide"))}var r=a.uiTagInputId,l=i.find("input"),s=i.find("span"),d=n.getTagInput(r);e.placeholder=d.config("placeholder"),e.text=d._text,e.$watch("text.value",function(){var n=s.width()+20;l.css("width",n+"px"),l.removeClass("error")}),l.on("blur",function(){t(d.pushTag)}),angular.element(l).bind("keydown keypress",function(n){switch(n.which){case 8:case 46:0===g(l[0])&&(t(function(){var n=d.popTag();if(null!==n&&d.config("enableEditingLastTag")){var e=n[d.config("displayProperty")];d.text(e+d.text()),t(function(){u(l[0],e.length)})}}),n.preventDefault());break;case 13:d.config("addOnEnter")&&(o(),n.preventDefault());break;case 32:d.config("addOnSpace")&&(o(),n.preventDefault());break;case 188:d.config("addOnComma")&&(o(),n.preventDefault())}}),d.config("allowMoreThanMaxTags")||d.on("onTagAdded",c).on("onTagRemoved",c)}}}]);
Model=function n(t,o,i,r){function e(){var n=this,e={};n.on=function(t,o){return(e[t]||(e[t]=[])).push(o),n},n.trigger=function(n,t){for(var o=e[n],i=0;o&&i<o.length;)o[i++](t)},n.off=function(t,r){for(i=e[t]||[];r&&(o=i.indexOf(r))>-1;)i.splice(o,1);return e[t]=r?i:[],n};for(o in t)i=t[o],n[o]="function"==typeof i?function(){return(i=this.apply(n,arguments))===r?n:i}.bind(i):i;n.init&&n.init.apply(n,arguments)}return e.extend=function(e){i={};for(o in t)i[o]=t[o];for(o in e)i[o]=e[o],t[o]!==r&&(i["__"+o]=t[o]);return n(i)},e},"object"==typeof module&&(module.exports=Model);