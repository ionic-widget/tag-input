angular.module("ui.taginput",[]).provider("tagInputConfig",function(){function t(t,e){return i[t]?i[t](e):null}var e={displayProperty:{type:String,"default":"value"},minTags:{type:Number,"default":0},maxTags:{type:Number,"default":Number.MAX_SAFE_INTEGER},placeholder:{type:String,"default":""},icon:{type:String,"default":void 0},addOnEnter:{type:Boolean,"default":!0},addOnSpace:{type:Boolean,"default":!1},addOnComma:{type:Boolean,"default":!0},addOnBlur:{type:Boolean,"default":!0},allowedTagsPattern:{type:String,"default":".+"},enableEditingLastTag:{type:Boolean,"default":!1}},n=Model({init:function(n){for(var i in e)this[i]=t(e[i].type,n[i])||e[i]["default"];this.allowedTagsPatternRegex=new RegExp(this.allowedTagsPattern)},extend:function(n){for(var i in e)this[i]=t(e[i].type,n[i])||this[i];this.allowedTagsPatternRegex=new RegExp(this.allowedTagsPattern)},set:function(n,i){n in this&&(this[n]=t(e[n].type,i)||this[n],"allowedTagsPattern"===n&&(this.allowedTagsPatternRegex=new RegExp(this.allowedTagsPattern)))}}),i={};i[String]=function(t){return angular.isString(t)?t:null},i[Number]=function(t){return/^\d+$/.test(t)?parseInt(t):null},i[Array]=function(t){return angular.isArray(t)?t:null},i[Boolean]=function(t){return t===!0||t===!1?t:angular.isString(t)&&"true"===t};var a=Model({_tags:[],_text:{value:""},init:function(t){this._config=new n(t)},extendConfig:function(t){this._config.extend(t)},pushTag:function(t){if(angular.isDefined(t)){if(angular.isString(t)){if(""!==t&&this.config("allowedTagsPatternRegex").test(t)){var e={};return e[this.config("displayProperty")]=t,!!this.pushTag(e)}return!1}if(angular.isArray(t)){for(var n=0;n<t.length;n++)if(!this.pushTag(t[n]))return!1}else{if(!angular.isObject(t))return!1;if(this._tags.length>=this._config.maxTags)return!1;this._tags.push(t),setTimeout(function(){this.trigger("onTagAdded",t)}.bind(this))}}else if(""!==this.text())return this.pushTag(this.text())&&!!this.text("");return!0},popTag:function(t){if(angular.isDefined(t)){if(angular.isNumber(t)){if(t>=0){var e=this._tags.splice(t,1);if(1===e.length)return setTimeout(function(){this.trigger("onTagRemoved",e[0])}.bind(this)),e[0]}}else if(angular.isObject(t)){var n=this._tags.indexOf(t);return this.popTag(n)}}else{var e=this._tags.pop();if(void 0!==e)return setTimeout(function(){this.trigger("onTagRemoved",e)}.bind(this)),e}return null},config:function(t,e){return angular.isDefined(e)?void this._config.set(t,e):this._config[t]},text:function(t){return angular.isDefined(t)?void(this._text.value=t):this._text.value},getTags:function(){return this._tags}}),r={};this.$get=function(){return this},this.createTagInput=function(t,e){r[t]&&console.error("ui-tag-input with identifier '"+t+"' exists before. The config will be replaced"),r[t]=new a(e)},this.getTagInput=function(t){return r[t]}});
angular.module("ui.taginput").directive("tagInput",["$timeout","tagInputConfig",function(t,n){function e(e,i){var a=(n.getTagInput(e.uiTagInputId),i.find("input")[0]);i.bind("click",function(n){n.target==i[0]&&t(function(){a.focus()})}),e.$watch("tags.length",function(){t(function(){i[0].scrollLeft=i[0].scrollWidth})})}return{restrict:"E",replace:!0,scope:{uiTagInputId:"@"},template:'<div class="item secondary-search-bar category-search-bar"><span class="icon ion {{::tagInput.config(\'icon\')}} "></span><tag-list ui-tag-input-id="{{::uiTagInputId}}"></tag-list><growing-input ui-tag-input-id="{{::uiTagInputId}}"></growing-input></div>',compile:function(t,i){return n.createTagInput(i.uiTagInputId,i),e}}}]).directive("tagList",["tagInputConfig","$interpolate",function(t,n){return{restrict:"E",template:'<div class="tag-container"></div>',link:{pre:function(e,i,a){function c(t){r.popTag(this)}function u(t){return t[r.config("displayProperty")]}var o=a.uiTagInputId,r=t.getTagInput(o),g=i.find(".tag-container"),l={};r.on("onTagAdded",function(t){var e=n('<pill class="category-pill">{{name}} <i class="ion-close-round"></i></pill>')({name:u(t)}),i=angular.element(e);l[JSON.stringify(t)]=i,g.append(i),i.on("click",c.bind(t))}),r.on("onTagRemoved",function(t){var n=l[JSON.stringify(t)];n.off("click"),n.remove(),delete n})}}}}]).directive("growingInput",["tagInputConfig","$timeout",function(t,n){return{restrict:"E",template:'<div class="growingInput"><input type="text" placeholder="{{placeholder}}" ng-model="text.value"><span class="hiddenText">{{text.value || placeholder}}</span></div>',link:function(e,i,a){function c(){var t=u(g[0]),e=p.text(),i=e.substring(0,t);n(function(){p.pushTag(i)&&(p.text(e.substring(t)),n(function(){o(g[0],0)}))})}function u(t){return t.selectionStart===t.selectionEnd?t.selectionStart:-1}function o(t,n){t.setSelectionRange(n,n)}var r=a.uiTagInputId,g=i.find("input"),l=i.find("span"),p=t.getTagInput(r);e.placeholder=p.config("placeholder"),e.text=p._text,e.$watch("text.value",function(){var t=l.width()+20;g.css("width",t+"px")}),g.on("blur",function(){n(p.pushTag)}),angular.element(g).bind("keydown keypress",function(t){switch(t.which){case 8:case 46:0===u(g[0])&&(n(function(){var t=p.popTag();if(null!==t&&p.config("enableEditingLastTag")){var e=t[p.config("displayProperty")];p.text(e+p.text()),n(function(){o(g[0],e.length)})}}),t.preventDefault());break;case 13:p.config("addOnEnter")&&(c(),t.preventDefault());break;case 32:p.config("addOnSpace")&&(c(),t.preventDefault());break;case 188:p.config("addOnComma")&&(c(),t.preventDefault())}})}}}]);
Model=function n(o,t,i,f){function e(){var n=this,e={};n.on=function(n,o){(e[n]||(e[n]=[])).push(o)},n.trigger=function(n,o){for(var t=e[n],i=0;t&&i<t.length;)t[i++](o)},n.off=function(n,o){for(i=e[n]||[];o&&(t=i.indexOf(o))>-1;)i.splice(t,1);e[n]=o?i:[]};for(t in o)i=o[t],n[t]="function"==typeof i?function(){return(i=this.apply(n,arguments))===f?n:i}.bind(i):i;n.init&&n.init.apply(n,arguments)}return e.extend=function(e){i={};for(t in o)i[t]=o[t];for(t in e)i[t]=e[t],o[t]!==f&&(i["__"+t]=o[t]);return n(i)},e},"object"==typeof module&&(module.exports=Model);